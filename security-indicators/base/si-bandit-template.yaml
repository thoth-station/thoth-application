apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: si-bandit
  annotations:
    description: "Thoth: SI-Bandit"
    openshift.io/display-name: "Thoth: SI-Bandit"
    version: 0.7.0
    tags: thoth,ai-stacks,si-bandit
    template.openshift.io/documentation-url: https://github.com/Thoth-Station/
    template.openshift.io/long-description: >
      This template defines resources needed to run recommendation logic of Thoth to OpenShift.
    template.openshift.io/provider-display-name: "Red Hat, Inc."
  labels:
    app: thoth
    template: si-bandit
    component: si-bandit

objects:
  - apiVersion: argoproj.io/v1alpha1
    kind: Workflow
    metadata:
      annotations:
        thoth-station.ninja/template-version: 0.7.0
      labels:
        app: thoth
        component: si-bandit
      name: "${THOTH_SI_BANDIT_JOB_ID}"
    spec:
      arguments:
        parameters:
          - name: THOTH_SI_BANDIT_JOB_ID
            value: "${THOTH_SI_BANDIT_JOB_ID}"
          - name: THOTH_DOCUMENT_ID
            value: "${THOTH_SI_BANDIT_JOB_ID}"
          - name: THOTH_SI_BANDIT_PACKAGE_NAME
            value: "${THOTH_SI_BANDIT_PACKAGE_NAME}"
          - name: THOTH_SI_BANDIT_PACKAGE_VERSION
            value: "${THOTH_SI_BANDIT_PACKAGE_VERSION}"
          - name: THOTH_SI_BANDIT_PACKAGE_INDEX
            value: "${THOTH_SI_BANDIT_PACKAGE_INDEX}"
          - name: ceph_bucket_prefix
          - name: ceph_bucket_name
          - name: ceph_host
          - name: deployment_name
      entrypoint: si-bandit
      serviceAccountName: argo
      templates:
        - archiveLocation:
            archiveLogs: true
          name: si-bandit
          steps:
            - - arguments:
                  parameters:
                    - name: THOTH_SI_BANDIT_JOB_ID
                      value: "{{workflow.parameters.THOTH_SI_BANDIT_JOB_ID}}"
                    - name: THOTH_DOCUMENT_ID
                      value: "{{workflow.parameters.THOTH_DOCUMENT_ID}}"
                    - name: THOTH_SI_BANDIT_PACKAGE_NAME
                      value: "{{workflow.parameters.THOTH_SI_BANDIT_PACKAGE_NAME}}"
                    - name: THOTH_SI_BANDIT_PACKAGE_VERSION
                      value: "{{workflow.parameters.THOTH_SI_BANDIT_PACKAGE_VERSION}}"
                    - name: THOTH_SI_BANDIT_PACKAGE_INDEX
                      value: "{{workflow.parameters.THOTH_SI_BANDIT_PACKAGE_INDEX}}"
                    - name: THOTH_S3_ENDPOINT_URL
                      value: "{{workflow.parameters.ceph_host}}"
                    - name: THOTH_CEPH_BUCKET_NAME
                      value: "{{workflow.parameters.ceph_bucket_name}}"
                    - name: THOTH_CEPH_BUCKET_PREFIX
                      value: "{{workflow.parameters.ceph_bucket_prefix}}"
                    - name: THOTH_DEPLOYMENT_NAME
                      value: "{{workflow.parameters.deployment_name}}"
                name: bandit
                templateRef:
                  name: bandit
                  template: bandit
      volumes:
        - emptyDir: {}
          name: workdir
parameters:
  - name: THOTH_SI_BANDIT_JOB_ID
    displayName: si-bandit id
    description: A unique dentifier of bandit security indicator job.
    required: true
  - name: THOTH_SI_BANDIT_PACKAGE_NAME
    displayName: package name
    description: Name of package which is being analyzed.
    required: true
  - name: THOTH_SI_BANDIT_PACKAGE_VERSION
    displayName: package version
    description: Version of the package being analyzed.
    required: true
  - name: THOTH_SI_BANDIT_PACKAGE_INDEX
    displayName: package Index
    description: Index to get package from.
    value: "https://pypi.org/simple"
    required: true
