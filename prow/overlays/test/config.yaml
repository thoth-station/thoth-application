log_level: debug

prowjob_namespace: aicoe-infra
pod_namespace: aicoe-infra

plank:
  report_templates:
    "*": "[Full PR test history](https://prow.thoth-station.dev/pr-history?org={{.Spec.Refs.Org}}&repo={{.Spec.Refs.Repo}}&pr={{with index .Spec.Refs.Pulls 0}}{{.Number}}{{end}}). [Your PR dashboard](https://prow.thoth-station.dev/pr?query=is%3Apr%20state%3Aopen%20author%3A{{with index .Spec.Refs.Pulls 0}}{{.Author}}{{end}}). Please help us cut down on flakes by [open issue](https://github.com/{{.Spec.Refs.Org}}/{{.Spec.Refs.Repo}}/issues?q=is:issue+is:open) when you hit one in your PR."
  job_url_prefix_config:
    "*": https://prow.thoth-station.dev/view/
  pod_pending_timeout: 15m
  pod_unscheduled_timeout: 5m
  default_decoration_configs:
    "*":
      timeout: 2h
      grace_period: 15m
      utility_images:
        clonerefs: "gcr.io/k8s-prow/clonerefs:v20201002-9b61c96506"
        initupload: "gcr.io/k8s-prow/initupload:v20201002-9b61c96506"
        entrypoint: "gcr.io/k8s-prow/entrypoint:v20201002-9b61c96506"
        sidecar: "gcr.io/k8s-prow/sidecar:v20201002-9b61c96506"
      gcs_configuration:
        bucket: aicoe-infra-test
        path_strategy: explicit
      gcs_credentials_secret: gcs-credentials
      resources:
        clonerefs:
          requests:
            cpu: 100m
        initupload:
          requests:
            cpu: 100m
        place_entrypoint:
          requests:
            cpu: 100m
        sidecar:
          requests:
            cpu: 100m

sinker:
  resync_period: 1m
  max_prowjob_age: 48h
  max_pod_age: 48h
  terminated_pod_ttl: 30m

branch-protection:
  allow_disabled_policies: true
  orgs:
    thoth-station:
      exclude:
        - "^revert-"
        - "^kebechet-"
        - "^dependabot/"
      protect: true
      restrictions:
        users: []
        teams:
          - sourceops
        required_pull_request_reviews:
          dismiss_stale_reviews: false
        required_approving_review_count: 1
        required_status_checks:
          contexts:
            - aicoe-ci/pre-commit-check
      allow_force_pushes: false
      repos:
        srcops-testing:
          allow_force_pushes: true

tide:
  pr_status_base_urls:
    "*": https://prow.thoth-station.dev/pr

  merge_method:
    thoth-station: squash

  queries:
    - repos:
        - thoth-station/srcops-testing
      labels:
        - approved
      missingLabels:
        - do-not-merge
        - do-not-merge/hold
        - do-not-merge/invalid-owners-file
        - do-not-merge/work-in-progress
        - needs-rebase

  blocker_label: tide/merge-blocker
  squash_label: tide/merge-method-squash
  rebase_label: tide/merge-method-rebase
  merge_label: tide/merge-method-merge

  context_options:
    from-branch-protection: true
    skip-unknown-contexts: true
    orgs:
      thoth-station:
        repos:
          srcops-testing:
            required-contexts:
              - aicoe-ci/pre-commit-check
              - aicoe-ci/pytest-check

presubmits:
  thoth-station/srcops-testing:
    - name: try-out-prow-plus-tekton
      agent: tekton-pipeline
      always_run: true
      rerun_command: "/run try-out-tekton"
      trigger: "(?m)^/run (all|try-out-tekton),?(\\s+|$)"
      pipeline_run_spec:
        pipelineRef:
          name: pull-request-pipeline
        resources:
          - name: git
            resourceRef:
              name: PROW_IMPLICIT_GIT_REF
    - name: py38-pytest
      context: aicoe-ci-test/py38-pytest
      always_run: true
      skip_report: true
      rerun_command: "/run py38-pytest"
      trigger: "(?m)^/run (all|py38-pytest),?(\\s+|$)"
      spec:
        containers:
          - image: quay.io/thoth-station/thoth-pytest-ubi8-py38:v0.12.0
            imagePullPolicy: Always
            command:
              - "python3"
            args:
              - "setup.py"
              - "test"
