---
kind: CronJob
apiVersion: batch/v1beta1
metadata:
  name: slo-reporter
spec:
  schedule: "0 6 * * FRI"
  suspend: false
  concurrencyPolicy: Forbid
  successfulJobsHistoryLimit: 2
  failedJobsHistoryLimit: 4
  jobTemplate:
    spec:
      template:
        metadata:
          name: slo-reporter
          labels:
            app: thoth
            component: slo-reporter
        spec:
          containers:
            - image: "slo-reporter"
              name: slo-reporter
              env:
                - name: PROMETHEUS_PUSHGATEWAY_URL
                  valueFrom:
                    configMapKeyRef:
                      name: prometheus
                      key: pushgateway-url
                - name: SENDER_ADDRESS
                  valueFrom:
                    configMapKeyRef:
                      name: slo-reporter
                      key: sender-address
                - name: SMTP_SERVER
                  valueFrom:
                    configMapKeyRef:
                      name: slo-reporter
                      key: smtp-server
                - name: THANOS_ENDPOINT
                  valueFrom:
                    configMapKeyRef:
                      name: slo-reporter
                      key: thanos-endpoint
                - name: THANOS_ACCESS_TOKEN
                  valueFrom:
                    secretKeyRef:
                      name: slo-reporter
                      key: token
                - name: EMAIL_RECIPIENTS
                  valueFrom:
                    configMapKeyRef:
                      name: slo-reporter
                      key: email-recipients
                - name: THOTH_ENVIRONMENT
                  valueFrom:
                    configMapKeyRef:
                      name: thoth
                      key: deployment-name
                - name: METRICS_EXPORTER_FRONTEND_PROMETHEUS_INSTANCE
                  valueFrom:
                    configMapKeyRef:
                      name: prometheus
                      key: instance-metrics-exporter-frontend
              resources:
                requests:
                  memory: "256Mi"
                  cpu: "500m"
                limits:
                  memory: "512Mi"
                  cpu: "500m"
          restartPolicy: OnFailure
