apiVersion: template.openshift.io/v1
kind: Template
metadata:
  name: mi
  labels:
    app: mi

parameters:
  - name: REPOSITORY
    required: true
    description: GitHub repository whose Health Indicator will be computed
    displayName: inspected GitHub repository

objects:
  - apiVersion: argoproj.io/v1alpha1
    kind: Workflow
    metadata:
      generateName: mi-analysis-
      labels:
        app: scropsmetrics
    spec:
      serviceAccountName: argo
      entrypoint: mi
      ttlStrategy:
        secondsAfterCompletion: 10
        secondsAfterSuccess: 10
      templates:
        - name: "mi"
          dag:
            tasks:
              - name: "mi"
                templateRef:
                  name: "mi"
                  template: "mi-workflow"
                arguments:
                  parameters:
                    - name: REPOSITORY
                      value: ${REPOSITORY}
                    - name: IMAGE_STREAM_TAG
                      value: ${IMAGE_STREAM_TAG}
                    - name: IMAGE_STREAM_REGISTRY
                      value: ${IMAGE_STREAM_REGISTRY}
                    - name: IMAGE_STREAM_NAMESPACE
                      value: ${IMAGE_STREAM_NAMESPACE}
